import { identity } from '../util/identity.mjs';
import { isScheduler } from '../util/isScheduler.mjs';
import { defer } from './defer.mjs';
import { scheduleIterable } from '../scheduled/scheduleIterable.mjs';
export function generate(initialStateOrOptions, condition, iterate, resultSelectorOrScheduler, scheduler) {
    let resultSelector;
    let initialState;
    // TODO: Remove this as we move away from deprecated signatures
    // and move towards a configuration object argument.
    if (arguments.length === 1) {
        // If we only have one argument, we can assume it is a configuration object.
        // Note that folks not using TypeScript may trip over this.
        ({
            initialState,
            condition,
            iterate,
            resultSelector = identity,
            scheduler,
        } = initialStateOrOptions);
    }
    else {
        // Deprecated arguments path. Figure out what the user
        // passed and set it here.
        initialState = initialStateOrOptions;
        if (!resultSelectorOrScheduler || isScheduler(resultSelectorOrScheduler)) {
            resultSelector = identity;
            scheduler = resultSelectorOrScheduler;
        }
        else {
            resultSelector = resultSelectorOrScheduler;
        }
    }
    // The actual generator used to "generate" values.
    function* gen() {
        for (let state = initialState; !condition || condition(state); state = iterate(state)) {
            yield resultSelector(state);
        }
    }
    // We use `defer` because we want to defer the creation of the iterator from the iterable.
    return defer((scheduler
        ? // If a scheduler was provided, use `scheduleIterable` to ensure that iteration/generation
            // happens on the scheduler.
            () => scheduleIterable(gen(), scheduler)
        : // Otherwise, if there's no scheduler, we can just use the generator function directly in
            // `defer` and executing it will return the generator (which is iterable).
            gen));
}

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9yeGpzL3NyYy9pbnRlcm5hbC9vYnNlcnZhYmxlL2dlbmVyYXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxrQkFBa0IsQ0FBQztBQUU1QyxPQUFPLEVBQUUsV0FBVyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEQsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLFNBQVMsQ0FBQztBQUNoQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQXVVakUsTUFBTSxVQUFVLFFBQVEsQ0FDdEIscUJBQWdELEVBQ2hELFNBQTRCLEVBQzVCLE9BQXdCLEVBQ3hCLHlCQUE0RCxFQUM1RCxTQUF5QjtJQUV6QixJQUFJLGNBQWdDLENBQUM7SUFDckMsSUFBSSxZQUFlLENBQUM7SUFFcEIsK0RBQStEO0lBQy9ELG9EQUFvRDtJQUNwRCxJQUFJLFNBQVMsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFLENBQUM7UUFDM0IsNEVBQTRFO1FBQzVFLDJEQUEyRDtRQUMzRCxDQUFDO1lBQ0MsWUFBWTtZQUNaLFNBQVM7WUFDVCxPQUFPO1lBQ1AsY0FBYyxHQUFHLFFBQTRCO1lBQzdDLFNBQVM7U0FDVixHQUFHLHFCQUE4QyxDQUFDLENBQUM7SUFDdEQsQ0FBQztTQUFNLENBQUM7UUFDTixzREFBc0Q7UUFDdEQsMEJBQTBCO1FBQzFCLFlBQVksR0FBRyxxQkFBMEIsQ0FBQztRQUMxQyxJQUFJLENBQUMseUJBQXlCLElBQUksV0FBVyxDQUFDLHlCQUF5QixDQUFDLEVBQUUsQ0FBQztZQUN6RSxjQUFjLEdBQUcsUUFBNEIsQ0FBQztZQUM5QyxTQUFTLEdBQUcseUJBQTBDLENBQUM7UUFDekQsQ0FBQzthQUFNLENBQUM7WUFDTixjQUFjLEdBQUcseUJBQTZDLENBQUM7UUFDakUsQ0FBQztJQUNILENBQUM7SUFFRCxrREFBa0Q7SUFDbEQsUUFBUSxDQUFDLENBQUMsR0FBRztRQUNYLEtBQUssSUFBSSxLQUFLLEdBQUcsWUFBWSxFQUFFLENBQUMsU0FBUyxJQUFJLFNBQVMsQ0FBQyxLQUFLLENBQUMsRUFBRSxLQUFLLEdBQUcsT0FBUSxDQUFDLEtBQUssQ0FBQyxFQUFFLENBQUM7WUFDdkYsTUFBTSxjQUFjLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDOUIsQ0FBQztJQUNILENBQUM7SUFFRCwwRkFBMEY7SUFDMUYsT0FBTyxLQUFLLENBQ1YsQ0FBQyxTQUFTO1FBQ1IsQ0FBQyxDQUFDLDBGQUEwRjtZQUMxRiw0QkFBNEI7WUFDNUIsR0FBRyxFQUFFLENBQUMsZ0JBQWdCLENBQUMsR0FBRyxFQUFFLEVBQUUsU0FBVSxDQUFDO1FBQzNDLENBQUMsQ0FBQyx5RkFBeUY7WUFDekYsMEVBQTBFO1lBQzFFLEdBQUcsQ0FBNkIsQ0FDckMsQ0FBQztBQUNKLENBQUMiLCJmaWxlIjoibm9kZV9tb2R1bGVzL3J4anMvc3JjL2ludGVybmFsL29ic2VydmFibGUvZ2VuZXJhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPYnNlcnZhYmxlIH0gZnJvbSAnLi4vT2JzZXJ2YWJsZSc7XG5pbXBvcnQgeyBpZGVudGl0eSB9IGZyb20gJy4uL3V0aWwvaWRlbnRpdHknO1xuaW1wb3J0IHsgT2JzZXJ2YWJsZUlucHV0LCBTY2hlZHVsZXJMaWtlIH0gZnJvbSAnLi4vdHlwZXMnO1xuaW1wb3J0IHsgaXNTY2hlZHVsZXIgfSBmcm9tICcuLi91dGlsL2lzU2NoZWR1bGVyJztcbmltcG9ydCB7IGRlZmVyIH0gZnJvbSAnLi9kZWZlcic7XG5pbXBvcnQgeyBzY2hlZHVsZUl0ZXJhYmxlIH0gZnJvbSAnLi4vc2NoZWR1bGVkL3NjaGVkdWxlSXRlcmFibGUnO1xuXG50eXBlIENvbmRpdGlvbkZ1bmM8Uz4gPSAoc3RhdGU6IFMpID0+IGJvb2xlYW47XG50eXBlIEl0ZXJhdGVGdW5jPFM+ID0gKHN0YXRlOiBTKSA9PiBTO1xudHlwZSBSZXN1bHRGdW5jPFMsIFQ+ID0gKHN0YXRlOiBTKSA9PiBUO1xuXG5leHBvcnQgaW50ZXJmYWNlIEdlbmVyYXRlQmFzZU9wdGlvbnM8Uz4ge1xuICAvKipcbiAgICogSW5pdGlhbCBzdGF0ZS5cbiAgICovXG4gIGluaXRpYWxTdGF0ZTogUztcbiAgLyoqXG4gICAqIENvbmRpdGlvbiBmdW5jdGlvbiB0aGF0IGFjY2VwdHMgc3RhdGUgYW5kIHJldHVybnMgYm9vbGVhbi5cbiAgICogV2hlbiBpdCByZXR1cm5zIGZhbHNlLCB0aGUgZ2VuZXJhdG9yIHN0b3BzLlxuICAgKiBJZiBub3Qgc3BlY2lmaWVkLCBhIGdlbmVyYXRvciBuZXZlciBzdG9wcy5cbiAgICovXG4gIGNvbmRpdGlvbj86IENvbmRpdGlvbkZ1bmM8Uz47XG4gIC8qKlxuICAgKiBJdGVyYXRlIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBzdGF0ZSBhbmQgcmV0dXJucyBuZXcgc3RhdGUuXG4gICAqL1xuICBpdGVyYXRlOiBJdGVyYXRlRnVuYzxTPjtcbiAgLyoqXG4gICAqIFNjaGVkdWxlckxpa2UgdG8gdXNlIGZvciBnZW5lcmF0aW9uIHByb2Nlc3MuXG4gICAqIEJ5IGRlZmF1bHQsIGEgZ2VuZXJhdG9yIHN0YXJ0cyBpbW1lZGlhdGVseS5cbiAgICovXG4gIHNjaGVkdWxlcj86IFNjaGVkdWxlckxpa2U7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgR2VuZXJhdGVPcHRpb25zPFQsIFM+IGV4dGVuZHMgR2VuZXJhdGVCYXNlT3B0aW9uczxTPiB7XG4gIC8qKlxuICAgKiBSZXN1bHQgc2VsZWN0aW9uIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyBzdGF0ZSBhbmQgcmV0dXJucyBhIHZhbHVlIHRvIGVtaXQuXG4gICAqL1xuICByZXN1bHRTZWxlY3RvcjogUmVzdWx0RnVuYzxTLCBUPjtcbn1cblxuLyoqXG4gKiBHZW5lcmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBydW5uaW5nIGEgc3RhdGUtZHJpdmVuIGxvb3BcbiAqIHByb2R1Y2luZyB0aGUgc2VxdWVuY2UncyBlbGVtZW50cywgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXJcbiAqIHRvIHNlbmQgb3V0IG9ic2VydmVyIG1lc3NhZ2VzLlxuICpcbiAqICFbXShnZW5lcmF0ZS5wbmcpXG4gKlxuICogIyMgRXhhbXBsZXNcbiAqXG4gKiBQcm9kdWNlcyBzZXF1ZW5jZSBvZiBudW1iZXJzXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGdlbmVyYXRlIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGUoMCwgeCA9PiB4IDwgMywgeCA9PiB4ICsgMSwgeCA9PiB4KTtcbiAqXG4gKiByZXN1bHQuc3Vic2NyaWJlKHggPT4gY29uc29sZS5sb2coeCkpO1xuICpcbiAqIC8vIExvZ3M6XG4gKiAvLyAwXG4gKiAvLyAxXG4gKiAvLyAyXG4gKiBgYGBcbiAqXG4gKiBVc2UgYGFzYXBTY2hlZHVsZXJgXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGdlbmVyYXRlLCBhc2FwU2NoZWR1bGVyIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGUoMSwgeCA9PiB4IDwgNSwgeCA9PiB4ICogMiwgeCA9PiB4ICsgMSwgYXNhcFNjaGVkdWxlcik7XG4gKlxuICogcmVzdWx0LnN1YnNjcmliZSh4ID0+IGNvbnNvbGUubG9nKHgpKTtcbiAqXG4gKiAvLyBMb2dzOlxuICogLy8gMlxuICogLy8gM1xuICogLy8gNVxuICogYGBgXG4gKlxuICogQHNlZSB7QGxpbmsgZnJvbX1cbiAqIEBzZWUge0BsaW5rIE9ic2VydmFibGV9XG4gKlxuICogQHBhcmFtIHtTfSBpbml0aWFsU3RhdGUgSW5pdGlhbCBzdGF0ZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24gKHN0YXRlOiBTKTogYm9vbGVhbn0gY29uZGl0aW9uIENvbmRpdGlvbiB0byB0ZXJtaW5hdGUgZ2VuZXJhdGlvbiAodXBvbiByZXR1cm5pbmcgZmFsc2UpLlxuICogQHBhcmFtIHtmdW5jdGlvbiAoc3RhdGU6IFMpOiBTfSBpdGVyYXRlIEl0ZXJhdGlvbiBzdGVwIGZ1bmN0aW9uLlxuICogQHBhcmFtIHtmdW5jdGlvbiAoc3RhdGU6IFMpOiBUfSByZXN1bHRTZWxlY3RvciBTZWxlY3RvciBmdW5jdGlvbiBmb3IgcmVzdWx0cyBwcm9kdWNlZCBpbiB0aGUgc2VxdWVuY2UuIChkZXByZWNhdGVkKVxuICogQHBhcmFtIHtTY2hlZHVsZXJMaWtlfSBbc2NoZWR1bGVyXSBBIHtAbGluayBTY2hlZHVsZXJMaWtlfSBvbiB3aGljaCB0byBydW4gdGhlIGdlbmVyYXRvciBsb29wLiBJZiBub3QgcHJvdmlkZWQsIGRlZmF1bHRzIHRvIGVtaXQgaW1tZWRpYXRlbHkuXG4gKiBAcmV0dXJucyB7T2JzZXJ2YWJsZTxUPn0gVGhlIGdlbmVyYXRlZCBzZXF1ZW5jZS5cbiAqIEBkZXByZWNhdGVkIEluc3RlYWQgb2YgcGFzc2luZyBzZXBhcmF0ZSBhcmd1bWVudHMsIHVzZSB0aGUgb3B0aW9ucyBhcmd1bWVudC4gU2lnbmF0dXJlcyB0YWtpbmcgc2VwYXJhdGUgYXJndW1lbnRzIHdpbGwgYmUgcmVtb3ZlZCBpbiB2OC5cbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlPFQsIFM+KFxuICBpbml0aWFsU3RhdGU6IFMsXG4gIGNvbmRpdGlvbjogQ29uZGl0aW9uRnVuYzxTPixcbiAgaXRlcmF0ZTogSXRlcmF0ZUZ1bmM8Uz4sXG4gIHJlc3VsdFNlbGVjdG9yOiBSZXN1bHRGdW5jPFMsIFQ+LFxuICBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlXG4pOiBPYnNlcnZhYmxlPFQ+O1xuXG4vKipcbiAqIEdlbmVyYXRlcyBhbiBPYnNlcnZhYmxlIGJ5IHJ1bm5pbmcgYSBzdGF0ZS1kcml2ZW4gbG9vcFxuICogdGhhdCBlbWl0cyBhbiBlbGVtZW50IG9uIGVhY2ggaXRlcmF0aW9uLlxuICpcbiAqIDxzcGFuIGNsYXNzPVwiaW5mb3JtYWxcIj5Vc2UgaXQgaW5zdGVhZCBvZiBuZXh0aW5nIHZhbHVlcyBpbiBhIGZvciBsb29wLjwvc3Bhbj5cbiAqXG4gKiAhW10oZ2VuZXJhdGUucG5nKVxuICpcbiAqIGBnZW5lcmF0ZWAgYWxsb3dzIHlvdSB0byBjcmVhdGUgYSBzdHJlYW0gb2YgdmFsdWVzIGdlbmVyYXRlZCB3aXRoIGEgbG9vcCB2ZXJ5IHNpbWlsYXIgdG9cbiAqIGEgdHJhZGl0aW9uYWwgZm9yIGxvb3AuIFRoZSBmaXJzdCBhcmd1bWVudCBvZiBgZ2VuZXJhdGVgIGlzIGEgYmVnaW5uaW5nIHZhbHVlLiBUaGUgc2Vjb25kIGFyZ3VtZW50XG4gKiBpcyBhIGZ1bmN0aW9uIHRoYXQgYWNjZXB0cyB0aGlzIHZhbHVlIGFuZCB0ZXN0cyBpZiBzb21lIGNvbmRpdGlvbiBzdGlsbCBob2xkcy4gSWYgaXQgZG9lcyxcbiAqIHRoZW4gdGhlIGxvb3AgY29udGludWVzLCBpZiBub3QsIGl0IHN0b3BzLiBUaGUgdGhpcmQgdmFsdWUgaXMgYSBmdW5jdGlvbiB3aGljaCB0YWtlcyB0aGVcbiAqIHByZXZpb3VzbHkgZGVmaW5lZCB2YWx1ZSBhbmQgbW9kaWZpZXMgaXQgaW4gc29tZSB3YXkgb24gZWFjaCBpdGVyYXRpb24uIE5vdGUgaG93IHRoZXNlIHRocmVlIHBhcmFtZXRlcnNcbiAqIGFyZSBkaXJlY3QgZXF1aXZhbGVudHMgb2YgdGhyZWUgZXhwcmVzc2lvbnMgaW4gYSB0cmFkaXRpb25hbCBmb3IgbG9vcDogdGhlIGZpcnN0IGV4cHJlc3Npb25cbiAqIGluaXRpYWxpemVzIHNvbWUgc3RhdGUgKGZvciBleGFtcGxlLCBhIG51bWVyaWMgaW5kZXgpLCB0aGUgc2Vjb25kIHRlc3RzIGlmIHRoZSBsb29wIGNhbiBwZXJmb3JtIHRoZSBuZXh0XG4gKiBpdGVyYXRpb24gKGZvciBleGFtcGxlLCBpZiB0aGUgaW5kZXggaXMgbG93ZXIgdGhhbiAxMCkgYW5kIHRoZSB0aGlyZCBzdGF0ZXMgaG93IHRoZSBkZWZpbmVkIHZhbHVlXG4gKiB3aWxsIGJlIG1vZGlmaWVkIG9uIGV2ZXJ5IHN0ZXAgKGZvciBleGFtcGxlLCB0aGUgaW5kZXggd2lsbCBiZSBpbmNyZW1lbnRlZCBieSBvbmUpLlxuICpcbiAqIFJldHVybiB2YWx1ZSBvZiBhIGBnZW5lcmF0ZWAgb3BlcmF0b3IgaXMgYW4gT2JzZXJ2YWJsZSB0aGF0IG9uIGVhY2ggbG9vcCBpdGVyYXRpb25cbiAqIGVtaXRzIGEgdmFsdWUuIEZpcnN0IG9mIGFsbCwgdGhlIGNvbmRpdGlvbiBmdW5jdGlvbiBpcyByYW4uIElmIGl0IHJldHVybnMgdHJ1ZSwgdGhlbiB0aGUgT2JzZXJ2YWJsZVxuICogZW1pdHMgdGhlIGN1cnJlbnRseSBzdG9yZWQgdmFsdWUgKGluaXRpYWwgdmFsdWUgYXQgdGhlIGZpcnN0IGl0ZXJhdGlvbikgYW5kIGZpbmFsbHkgdXBkYXRlc1xuICogdGhhdCB2YWx1ZSB3aXRoIGl0ZXJhdGUgZnVuY3Rpb24uIElmIGF0IHNvbWUgcG9pbnQgdGhlIGNvbmRpdGlvbiByZXR1cm5zIGZhbHNlLCB0aGVuIHRoZSBPYnNlcnZhYmxlXG4gKiBjb21wbGV0ZXMgYXQgdGhhdCBtb21lbnQuXG4gKlxuICogT3B0aW9uYWxseSB5b3UgY2FuIHBhc3MgYSBmb3VydGggcGFyYW1ldGVyIHRvIGBnZW5lcmF0ZWAgLSBhIHJlc3VsdCBzZWxlY3RvciBmdW5jdGlvbiB3aGljaCBhbGxvd3MgeW91XG4gKiB0byBpbW1lZGlhdGVseSBtYXAgdGhlIHZhbHVlIHRoYXQgd291bGQgbm9ybWFsbHkgYmUgZW1pdHRlZCBieSBhbiBPYnNlcnZhYmxlLlxuICpcbiAqIElmIHlvdSBmaW5kIHRocmVlIGFub255bW91cyBmdW5jdGlvbnMgaW4gYGdlbmVyYXRlYCBjYWxsIGhhcmQgdG8gcmVhZCwgeW91IGNhbiBwcm92aWRlXG4gKiBhIHNpbmdsZSBvYmplY3QgdG8gdGhlIG9wZXJhdG9yIGluc3RlYWQgd2hlcmUgdGhlIG9iamVjdCBoYXMgdGhlIHByb3BlcnRpZXM6IGBpbml0aWFsU3RhdGVgLFxuICogYGNvbmRpdGlvbmAsIGBpdGVyYXRlYCBhbmQgYHJlc3VsdFNlbGVjdG9yYCwgd2hpY2ggc2hvdWxkIGhhdmUgcmVzcGVjdGl2ZSB2YWx1ZXMgdGhhdCB5b3VcbiAqIHdvdWxkIG5vcm1hbGx5IHBhc3MgdG8gYGdlbmVyYXRlYC4gYHJlc3VsdFNlbGVjdG9yYCBpcyBzdGlsbCBvcHRpb25hbCwgYnV0IHRoYXQgZm9ybVxuICogb2YgY2FsbGluZyBgZ2VuZXJhdGVgIGFsbG93cyB5b3UgdG8gb21pdCBgY29uZGl0aW9uYCBhcyB3ZWxsLiBJZiB5b3Ugb21pdCBpdCwgdGhhdCBtZWFuc1xuICogY29uZGl0aW9uIGFsd2F5cyBob2xkcywgb3IgaW4gb3RoZXIgd29yZHMgdGhlIHJlc3VsdGluZyBPYnNlcnZhYmxlIHdpbGwgbmV2ZXIgY29tcGxldGUuXG4gKlxuICogQm90aCBmb3JtcyBvZiBgZ2VuZXJhdGVgIGNhbiBvcHRpb25hbGx5IGFjY2VwdCBhIHNjaGVkdWxlci4gSW4gY2FzZSBvZiBhIG11bHRpLXBhcmFtZXRlciBjYWxsLFxuICogc2NoZWR1bGVyIHNpbXBseSBjb21lcyBhcyBhIGxhc3QgYXJndW1lbnQgKG5vIG1hdHRlciBpZiB0aGVyZSBpcyBhIGByZXN1bHRTZWxlY3RvcmBcbiAqIGZ1bmN0aW9uIG9yIG5vdCkuIEluIGNhc2Ugb2YgYSBzaW5nbGUtcGFyYW1ldGVyIGNhbGwsIHlvdSBjYW4gcHJvdmlkZSBpdCBhcyBhXG4gKiBgc2NoZWR1bGVyYCBwcm9wZXJ0eSBvbiB0aGUgb2JqZWN0IHBhc3NlZCB0byB0aGUgb3BlcmF0b3IuIEluIGJvdGggY2FzZXMsIGEgc2NoZWR1bGVyIGRlY2lkZXMgd2hlblxuICogdGhlIG5leHQgaXRlcmF0aW9uIG9mIHRoZSBsb29wIHdpbGwgaGFwcGVuIGFuZCB0aGVyZWZvcmUgd2hlbiB0aGUgbmV4dCB2YWx1ZSB3aWxsIGJlIGVtaXR0ZWRcbiAqIGJ5IHRoZSBPYnNlcnZhYmxlLiBGb3IgZXhhbXBsZSwgdG8gZW5zdXJlIHRoYXQgZWFjaCB2YWx1ZSBpcyBwdXNoZWQgdG8gdGhlIE9ic2VydmVyXG4gKiBvbiBhIHNlcGFyYXRlIHRhc2sgaW4gdGhlIGV2ZW50IGxvb3AsIHlvdSBjb3VsZCB1c2UgdGhlIGBhc3luY2Agc2NoZWR1bGVyLiBOb3RlIHRoYXRcbiAqIGJ5IGRlZmF1bHQgKHdoZW4gbm8gc2NoZWR1bGVyIGlzIHBhc3NlZCkgdmFsdWVzIGFyZSBzaW1wbHkgZW1pdHRlZCBzeW5jaHJvbm91c2x5LlxuICpcbiAqXG4gKiAjIyBFeGFtcGxlc1xuICpcbiAqIFVzZSB3aXRoIGNvbmRpdGlvbiBhbmQgaXRlcmF0ZSBmdW5jdGlvbnNcbiAqXG4gKiBgYGB0c1xuICogaW1wb3J0IHsgZ2VuZXJhdGUgfSBmcm9tICdyeGpzJztcbiAqXG4gKiBjb25zdCByZXN1bHQgPSBnZW5lcmF0ZSgwLCB4ID0+IHggPCAzLCB4ID0+IHggKyAxKTtcbiAqXG4gKiByZXN1bHQuc3Vic2NyaWJlKHtcbiAqICAgbmV4dDogdmFsdWUgPT4gY29uc29sZS5sb2codmFsdWUpLFxuICogICBjb21wbGV0ZTogKCkgPT4gY29uc29sZS5sb2coJ0NvbXBsZXRlIScpXG4gKiB9KTtcbiAqXG4gKiAvLyBMb2dzOlxuICogLy8gMFxuICogLy8gMVxuICogLy8gMlxuICogLy8gJ0NvbXBsZXRlISdcbiAqIGBgYFxuICpcbiAqIFVzZSB3aXRoIGNvbmRpdGlvbiwgaXRlcmF0ZSBhbmQgcmVzdWx0U2VsZWN0b3IgZnVuY3Rpb25zXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGdlbmVyYXRlIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGUoMCwgeCA9PiB4IDwgMywgeCA9PiB4ICsgMSwgeCA9PiB4ICogMTAwMCk7XG4gKlxuICogcmVzdWx0LnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IHZhbHVlID0+IGNvbnNvbGUubG9nKHZhbHVlKSxcbiAqICAgY29tcGxldGU6ICgpID0+IGNvbnNvbGUubG9nKCdDb21wbGV0ZSEnKVxuICogfSk7XG4gKlxuICogLy8gTG9nczpcbiAqIC8vIDBcbiAqIC8vIDEwMDBcbiAqIC8vIDIwMDBcbiAqIC8vICdDb21wbGV0ZSEnXG4gKiBgYGBcbiAqXG4gKiBVc2Ugd2l0aCBvcHRpb25zIG9iamVjdFxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBnZW5lcmF0ZSB9IGZyb20gJ3J4anMnO1xuICpcbiAqIGNvbnN0IHJlc3VsdCA9IGdlbmVyYXRlKHtcbiAqICAgaW5pdGlhbFN0YXRlOiAwLFxuICogICBjb25kaXRpb24odmFsdWUpIHsgcmV0dXJuIHZhbHVlIDwgMzsgfSxcbiAqICAgaXRlcmF0ZSh2YWx1ZSkgeyByZXR1cm4gdmFsdWUgKyAxOyB9LFxuICogICByZXN1bHRTZWxlY3Rvcih2YWx1ZSkgeyByZXR1cm4gdmFsdWUgKiAxMDAwOyB9XG4gKiB9KTtcbiAqXG4gKiByZXN1bHQuc3Vic2NyaWJlKHtcbiAqICAgbmV4dDogdmFsdWUgPT4gY29uc29sZS5sb2codmFsdWUpLFxuICogICBjb21wbGV0ZTogKCkgPT4gY29uc29sZS5sb2coJ0NvbXBsZXRlIScpXG4gKiB9KTtcbiAqXG4gKiAvLyBMb2dzOlxuICogLy8gMFxuICogLy8gMTAwMFxuICogLy8gMjAwMFxuICogLy8gJ0NvbXBsZXRlISdcbiAqIGBgYFxuICpcbiAqIFVzZSBvcHRpb25zIG9iamVjdCB3aXRob3V0IGNvbmRpdGlvbiBmdW5jdGlvblxuICpcbiAqIGBgYHRzXG4gKiBpbXBvcnQgeyBnZW5lcmF0ZSB9IGZyb20gJ3J4anMnO1xuICpcbiAqIGNvbnN0IHJlc3VsdCA9IGdlbmVyYXRlKHtcbiAqICAgaW5pdGlhbFN0YXRlOiAwLFxuICogICBpdGVyYXRlKHZhbHVlKSB7IHJldHVybiB2YWx1ZSArIDE7IH0sXG4gKiAgIHJlc3VsdFNlbGVjdG9yKHZhbHVlKSB7IHJldHVybiB2YWx1ZSAqIDEwMDA7IH1cbiAqIH0pO1xuICpcbiAqIHJlc3VsdC5zdWJzY3JpYmUoe1xuICogICBuZXh0OiB2YWx1ZSA9PiBjb25zb2xlLmxvZyh2YWx1ZSksXG4gKiAgIGNvbXBsZXRlOiAoKSA9PiBjb25zb2xlLmxvZygnQ29tcGxldGUhJykgLy8gVGhpcyB3aWxsIG5ldmVyIHJ1blxuICogfSk7XG4gKlxuICogLy8gTG9nczpcbiAqIC8vIDBcbiAqIC8vIDEwMDBcbiAqIC8vIDIwMDBcbiAqIC8vIDMwMDBcbiAqIC8vIC4uLmFuZCBuZXZlciBzdG9wcy5cbiAqIGBgYFxuICpcbiAqIEBzZWUge0BsaW5rIGZyb219XG4gKlxuICogQHBhcmFtIHtTfSBpbml0aWFsU3RhdGUgSW5pdGlhbCBzdGF0ZS5cbiAqIEBwYXJhbSB7ZnVuY3Rpb24gKHN0YXRlOiBTKTogYm9vbGVhbn0gY29uZGl0aW9uIENvbmRpdGlvbiB0byB0ZXJtaW5hdGUgZ2VuZXJhdGlvbiAodXBvbiByZXR1cm5pbmcgZmFsc2UpLlxuICogQHBhcmFtIHtmdW5jdGlvbiAoc3RhdGU6IFMpOiBTfSBpdGVyYXRlIEl0ZXJhdGlvbiBzdGVwIGZ1bmN0aW9uLlxuICogQHBhcmFtIHtmdW5jdGlvbiAoc3RhdGU6IFMpOiBUfSBbcmVzdWx0U2VsZWN0b3JdIFNlbGVjdG9yIGZ1bmN0aW9uIGZvciByZXN1bHRzIHByb2R1Y2VkIGluIHRoZSBzZXF1ZW5jZS5cbiAqIEBwYXJhbSB7U2NoZWR1bGVyfSBbc2NoZWR1bGVyXSBBIHtAbGluayBTY2hlZHVsZXJ9IG9uIHdoaWNoIHRvIHJ1biB0aGUgZ2VuZXJhdG9yIGxvb3AuIElmIG5vdCBwcm92aWRlZCwgZGVmYXVsdHMgdG8gZW1pdHRpbmcgaW1tZWRpYXRlbHkuXG4gKiBAcmV0dXJuIHtPYnNlcnZhYmxlPFQ+fSBUaGUgZ2VuZXJhdGVkIHNlcXVlbmNlLlxuICogQGRlcHJlY2F0ZWQgSW5zdGVhZCBvZiBwYXNzaW5nIHNlcGFyYXRlIGFyZ3VtZW50cywgdXNlIHRoZSBvcHRpb25zIGFyZ3VtZW50LiBTaWduYXR1cmVzIHRha2luZyBzZXBhcmF0ZSBhcmd1bWVudHMgd2lsbCBiZSByZW1vdmVkIGluIHY4LlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGU8Uz4oXG4gIGluaXRpYWxTdGF0ZTogUyxcbiAgY29uZGl0aW9uOiBDb25kaXRpb25GdW5jPFM+LFxuICBpdGVyYXRlOiBJdGVyYXRlRnVuYzxTPixcbiAgc2NoZWR1bGVyPzogU2NoZWR1bGVyTGlrZVxuKTogT2JzZXJ2YWJsZTxTPjtcblxuLyoqXG4gKiBHZW5lcmF0ZXMgYW4gb2JzZXJ2YWJsZSBzZXF1ZW5jZSBieSBydW5uaW5nIGEgc3RhdGUtZHJpdmVuIGxvb3BcbiAqIHByb2R1Y2luZyB0aGUgc2VxdWVuY2UncyBlbGVtZW50cywgdXNpbmcgdGhlIHNwZWNpZmllZCBzY2hlZHVsZXJcbiAqIHRvIHNlbmQgb3V0IG9ic2VydmVyIG1lc3NhZ2VzLlxuICogVGhlIG92ZXJsb2FkIGFjY2VwdHMgb3B0aW9ucyBvYmplY3QgdGhhdCBtaWdodCBjb250YWluIGluaXRpYWwgc3RhdGUsIGl0ZXJhdGUsXG4gKiBjb25kaXRpb24gYW5kIHNjaGVkdWxlci5cbiAqXG4gKiAhW10oZ2VuZXJhdGUucG5nKVxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogVXNlIG9wdGlvbnMgb2JqZWN0IHdpdGggY29uZGl0aW9uIGZ1bmN0aW9uXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGdlbmVyYXRlIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGUoe1xuICogICBpbml0aWFsU3RhdGU6IDAsXG4gKiAgIGNvbmRpdGlvbjogeCA9PiB4IDwgMyxcbiAqICAgaXRlcmF0ZTogeCA9PiB4ICsgMVxuICogfSk7XG4gKlxuICogcmVzdWx0LnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IHZhbHVlID0+IGNvbnNvbGUubG9nKHZhbHVlKSxcbiAqICAgY29tcGxldGU6ICgpID0+IGNvbnNvbGUubG9nKCdDb21wbGV0ZSEnKVxuICogfSk7XG4gKlxuICogLy8gTG9nczpcbiAqIC8vIDBcbiAqIC8vIDFcbiAqIC8vIDJcbiAqIC8vICdDb21wbGV0ZSEnXG4gKiBgYGBcbiAqXG4gKiBAc2VlIHtAbGluayBmcm9tfVxuICogQHNlZSB7QGxpbmsgT2JzZXJ2YWJsZX1cbiAqXG4gKiBAcGFyYW0ge0dlbmVyYXRlQmFzZU9wdGlvbnM8Uz59IG9wdGlvbnMgT2JqZWN0IHRoYXQgbXVzdCBjb250YWluIGluaXRpYWxTdGF0ZSwgaXRlcmF0ZSBhbmQgbWlnaHQgY29udGFpbiBjb25kaXRpb24gYW5kIHNjaGVkdWxlci5cbiAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPFM+fSBUaGUgZ2VuZXJhdGVkIHNlcXVlbmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGU8Uz4ob3B0aW9uczogR2VuZXJhdGVCYXNlT3B0aW9uczxTPik6IE9ic2VydmFibGU8Uz47XG5cbi8qKlxuICogR2VuZXJhdGVzIGFuIG9ic2VydmFibGUgc2VxdWVuY2UgYnkgcnVubmluZyBhIHN0YXRlLWRyaXZlbiBsb29wXG4gKiBwcm9kdWNpbmcgdGhlIHNlcXVlbmNlJ3MgZWxlbWVudHMsIHVzaW5nIHRoZSBzcGVjaWZpZWQgc2NoZWR1bGVyXG4gKiB0byBzZW5kIG91dCBvYnNlcnZlciBtZXNzYWdlcy5cbiAqIFRoZSBvdmVybG9hZCBhY2NlcHRzIG9wdGlvbnMgb2JqZWN0IHRoYXQgbWlnaHQgY29udGFpbiBpbml0aWFsIHN0YXRlLCBpdGVyYXRlLFxuICogY29uZGl0aW9uLCByZXN1bHQgc2VsZWN0b3IgYW5kIHNjaGVkdWxlci5cbiAqXG4gKiAhW10oZ2VuZXJhdGUucG5nKVxuICpcbiAqICMjIEV4YW1wbGVzXG4gKlxuICogVXNlIG9wdGlvbnMgb2JqZWN0IHdpdGggY29uZGl0aW9uIGFuZCBpdGVyYXRlIGZ1bmN0aW9uXG4gKlxuICogYGBgdHNcbiAqIGltcG9ydCB7IGdlbmVyYXRlIH0gZnJvbSAncnhqcyc7XG4gKlxuICogY29uc3QgcmVzdWx0ID0gZ2VuZXJhdGUoe1xuICogICBpbml0aWFsU3RhdGU6IDAsXG4gKiAgIGNvbmRpdGlvbjogeCA9PiB4IDwgMyxcbiAqICAgaXRlcmF0ZTogeCA9PiB4ICsgMSxcbiAqICAgcmVzdWx0U2VsZWN0b3I6IHggPT4geFxuICogfSk7XG4gKlxuICogcmVzdWx0LnN1YnNjcmliZSh7XG4gKiAgIG5leHQ6IHZhbHVlID0+IGNvbnNvbGUubG9nKHZhbHVlKSxcbiAqICAgY29tcGxldGU6ICgpID0+IGNvbnNvbGUubG9nKCdDb21wbGV0ZSEnKVxuICogfSk7XG4gKlxuICogLy8gTG9nczpcbiAqIC8vIDBcbiAqIC8vIDFcbiAqIC8vIDJcbiAqIC8vICdDb21wbGV0ZSEnXG4gKiBgYGBcbiAqXG4gKiBAc2VlIHtAbGluayBmcm9tfVxuICogQHNlZSB7QGxpbmsgT2JzZXJ2YWJsZX1cbiAqXG4gKiBAcGFyYW0ge0dlbmVyYXRlT3B0aW9uczxULCBTPn0gb3B0aW9ucyBPYmplY3QgdGhhdCBtdXN0IGNvbnRhaW4gaW5pdGlhbFN0YXRlLCBpdGVyYXRlLCByZXN1bHRTZWxlY3RvciBhbmQgbWlnaHQgY29udGFpbiBjb25kaXRpb24gYW5kIHNjaGVkdWxlci5cbiAqIEByZXR1cm5zIHtPYnNlcnZhYmxlPFQ+fSBUaGUgZ2VuZXJhdGVkIHNlcXVlbmNlLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGU8VCwgUz4ob3B0aW9uczogR2VuZXJhdGVPcHRpb25zPFQsIFM+KTogT2JzZXJ2YWJsZTxUPjtcblxuZXhwb3J0IGZ1bmN0aW9uIGdlbmVyYXRlPFQsIFM+KFxuICBpbml0aWFsU3RhdGVPck9wdGlvbnM6IFMgfCBHZW5lcmF0ZU9wdGlvbnM8VCwgUz4sXG4gIGNvbmRpdGlvbj86IENvbmRpdGlvbkZ1bmM8Uz4sXG4gIGl0ZXJhdGU/OiBJdGVyYXRlRnVuYzxTPixcbiAgcmVzdWx0U2VsZWN0b3JPclNjaGVkdWxlcj86IFJlc3VsdEZ1bmM8UywgVD4gfCBTY2hlZHVsZXJMaWtlLFxuICBzY2hlZHVsZXI/OiBTY2hlZHVsZXJMaWtlXG4pOiBPYnNlcnZhYmxlPFQ+IHtcbiAgbGV0IHJlc3VsdFNlbGVjdG9yOiBSZXN1bHRGdW5jPFMsIFQ+O1xuICBsZXQgaW5pdGlhbFN0YXRlOiBTO1xuXG4gIC8vIFRPRE86IFJlbW92ZSB0aGlzIGFzIHdlIG1vdmUgYXdheSBmcm9tIGRlcHJlY2F0ZWQgc2lnbmF0dXJlc1xuICAvLyBhbmQgbW92ZSB0b3dhcmRzIGEgY29uZmlndXJhdGlvbiBvYmplY3QgYXJndW1lbnQuXG4gIGlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7XG4gICAgLy8gSWYgd2Ugb25seSBoYXZlIG9uZSBhcmd1bWVudCwgd2UgY2FuIGFzc3VtZSBpdCBpcyBhIGNvbmZpZ3VyYXRpb24gb2JqZWN0LlxuICAgIC8vIE5vdGUgdGhhdCBmb2xrcyBub3QgdXNpbmcgVHlwZVNjcmlwdCBtYXkgdHJpcCBvdmVyIHRoaXMuXG4gICAgKHtcbiAgICAgIGluaXRpYWxTdGF0ZSxcbiAgICAgIGNvbmRpdGlvbixcbiAgICAgIGl0ZXJhdGUsXG4gICAgICByZXN1bHRTZWxlY3RvciA9IGlkZW50aXR5IGFzIFJlc3VsdEZ1bmM8UywgVD4sXG4gICAgICBzY2hlZHVsZXIsXG4gICAgfSA9IGluaXRpYWxTdGF0ZU9yT3B0aW9ucyBhcyBHZW5lcmF0ZU9wdGlvbnM8VCwgUz4pO1xuICB9IGVsc2Uge1xuICAgIC8vIERlcHJlY2F0ZWQgYXJndW1lbnRzIHBhdGguIEZpZ3VyZSBvdXQgd2hhdCB0aGUgdXNlclxuICAgIC8vIHBhc3NlZCBhbmQgc2V0IGl0IGhlcmUuXG4gICAgaW5pdGlhbFN0YXRlID0gaW5pdGlhbFN0YXRlT3JPcHRpb25zIGFzIFM7XG4gICAgaWYgKCFyZXN1bHRTZWxlY3Rvck9yU2NoZWR1bGVyIHx8IGlzU2NoZWR1bGVyKHJlc3VsdFNlbGVjdG9yT3JTY2hlZHVsZXIpKSB7XG4gICAgICByZXN1bHRTZWxlY3RvciA9IGlkZW50aXR5IGFzIFJlc3VsdEZ1bmM8UywgVD47XG4gICAgICBzY2hlZHVsZXIgPSByZXN1bHRTZWxlY3Rvck9yU2NoZWR1bGVyIGFzIFNjaGVkdWxlckxpa2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlc3VsdFNlbGVjdG9yID0gcmVzdWx0U2VsZWN0b3JPclNjaGVkdWxlciBhcyBSZXN1bHRGdW5jPFMsIFQ+O1xuICAgIH1cbiAgfVxuXG4gIC8vIFRoZSBhY3R1YWwgZ2VuZXJhdG9yIHVzZWQgdG8gXCJnZW5lcmF0ZVwiIHZhbHVlcy5cbiAgZnVuY3Rpb24qIGdlbigpIHtcbiAgICBmb3IgKGxldCBzdGF0ZSA9IGluaXRpYWxTdGF0ZTsgIWNvbmRpdGlvbiB8fCBjb25kaXRpb24oc3RhdGUpOyBzdGF0ZSA9IGl0ZXJhdGUhKHN0YXRlKSkge1xuICAgICAgeWllbGQgcmVzdWx0U2VsZWN0b3Ioc3RhdGUpO1xuICAgIH1cbiAgfVxuXG4gIC8vIFdlIHVzZSBgZGVmZXJgIGJlY2F1c2Ugd2Ugd2FudCB0byBkZWZlciB0aGUgY3JlYXRpb24gb2YgdGhlIGl0ZXJhdG9yIGZyb20gdGhlIGl0ZXJhYmxlLlxuICByZXR1cm4gZGVmZXIoXG4gICAgKHNjaGVkdWxlclxuICAgICAgPyAvLyBJZiBhIHNjaGVkdWxlciB3YXMgcHJvdmlkZWQsIHVzZSBgc2NoZWR1bGVJdGVyYWJsZWAgdG8gZW5zdXJlIHRoYXQgaXRlcmF0aW9uL2dlbmVyYXRpb25cbiAgICAgICAgLy8gaGFwcGVucyBvbiB0aGUgc2NoZWR1bGVyLlxuICAgICAgICAoKSA9PiBzY2hlZHVsZUl0ZXJhYmxlKGdlbigpLCBzY2hlZHVsZXIhKVxuICAgICAgOiAvLyBPdGhlcndpc2UsIGlmIHRoZXJlJ3Mgbm8gc2NoZWR1bGVyLCB3ZSBjYW4ganVzdCB1c2UgdGhlIGdlbmVyYXRvciBmdW5jdGlvbiBkaXJlY3RseSBpblxuICAgICAgICAvLyBgZGVmZXJgIGFuZCBleGVjdXRpbmcgaXQgd2lsbCByZXR1cm4gdGhlIGdlbmVyYXRvciAod2hpY2ggaXMgaXRlcmFibGUpLlxuICAgICAgICBnZW4pIGFzICgpID0+IE9ic2VydmFibGVJbnB1dDxUPlxuICApO1xufVxuIl19
